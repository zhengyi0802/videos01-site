/*! @name videojs-dvrseekbar @version 0.0.1 @license Apache-2.0 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],t):e.videojsDvrseekbar=t(e.videojs)}(this,function(e){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e;var t=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},r=function(){function e(i,r){t(this,e),r||(r={}),this.vjsPlayer_=i,this.options_=r,this.vjsPlayer_.dash&&this.vjsPlayer_.dash.shakaPlayer?(this.player_=this.vjsPlayer_.dash.shakaPlayer,this.player_.addEventListener("buffering",this.onBufferingStateChange_.bind(this))):this.player_=this.vjsPlayer_,window.setInterval(this.updateTimeAndSeekRange_.bind(this),125),this.video_=this.vjsPlayer_.tech_.el_,this.enabled_=!0,this.seekTimeoutId_=null;var n=document.createElement("input");n.setAttribute("type","range"),n.setAttribute("step","any"),n.setAttribute("min","0"),n.setAttribute("max","1"),n.setAttribute("value","0"),n.setAttribute("id","seekBar"),n.addEventListener("mousedown",this.onSeekStart_.bind(this)),n.addEventListener("touchstart",this.onSeekStart_.bind(this),{passive:!0}),n.addEventListener("input",this.onSeekInput_.bind(this)),n.addEventListener("touchend",this.onSeekEnd_.bind(this)),n.addEventListener("mouseup",this.onSeekEnd_.bind(this)),this.dvrSeekBar_=n,this.currentTime_=document.getElementById("dvr-current-time"),this.currentTime_.addEventListener("click",this.onCurrentTimeClick_.bind(this)),this.firstSeekRangeStart=null,r.flowMode}return e.prototype.getEl=function(){return this.dvrSeekBar_},e.prototype.onSeekStart_=function(){this.enabled_&&(this.isSeeking_=!0,this.video_.pause())},e.prototype.onSeekInput_=function(){this.enabled_&&this.video_.duration&&(this.updateTimeAndSeekRange_(),null!=this.seekTimeoutId_&&window.clearTimeout(this.seekTimeoutId_),this.seekTimeoutId_=window.setTimeout(this.onSeekInputTimeout_.bind(this),125))},e.prototype.onSeekInputTimeout_=function(){var e=parseFloat(this.dvrSeekBar_.value),t=this.getSeekRange().start;this.dvrSeekBar_.min=t,this.seekTimeoutId_=null,this.video_.currentTime=e<=t?t+30:e},e.prototype.onSeekEnd_=function(){this.enabled_&&(null!=this.seekTimeoutId_&&(window.clearTimeout(this.seekTimeoutId_),this.onSeekInputTimeout_()),this.isSeeking_=!1,this.video_.play())},e.prototype.onCurrentTimeClick_=function(){this.enabled_&&this.player_.isLive&&this.player_.isLive()&&(this.video_.currentTime=this.dvrSeekBar_.max)},e.prototype.onFlowModePlaying_=function(e){this.player_.isLive()&&(this.video_.currentTime=this.getSeekRange().start+30)},e.prototype.onBufferingStateChange_=function(e){},e.prototype.isOpaque_=function(){return!!this.enabled_&&this.vjsPlayer_.userActive()},e.prototype.getMediaSeekRangeSize_=function(){return this.getSeekRange().end-this.getSeekRange().start},e.prototype.buildTimeString_=function(e,t){var i=Math.floor(e/3600),r=Math.floor(e/60%60),n=Math.floor(e%60);n<10&&(n="0"+n);var s=r+":"+n;return t&&(r<10&&(s="0"+s),s=i+":"+s),s},e.prototype.updateTimeAndSeekRange_=function(){if(this.isOpaque_()){var e=this.getSeekRange();if(0!==e.end||e.start!==e.end){this.dvrSeekBar_.min=e.start,this.dvrSeekBar_.max=e.end;var t=this.getMediaSeekRangeSize_(),i=this.isSeeking_?this.dvrSeekBar_.value:this.video_.currentTime,r=this.video_.duration,n=this.video_.buffered.length,s=n?this.video_.buffered.start(0):0,a=n?this.video_.buffered.end(n-1):0;if(this.player_.isLive&&this.player_.isLive()){var o=Math.floor(e.end-i),l=t>=3600;(i=Math.max(0,o))>=15||this.isSeeking_?(this.options_.flowMode?(this.firstSeekRangeStart,!this.isSeeking_&&this.firstSeekRangeStart||(this.firstSeekRangeStart=e.start),this.currentTime_.textContent=this.buildTimeString_(this.video_.currentTime-this.firstSeekRangeStart,l),console.log("SeekRangeStart: "+e.start+" | SeekRangeEnd: "+e.end+" | CurrentTime: "+this.video_.currentTime+" | DisplayTime: "+i+" | SeekSize: "+t+" | Time: "+this.currentTime_.textContent)):this.currentTime_.textContent="- "+this.buildTimeString_(i,l),this.currentTime_.style.cursor="pointer"):(this.currentTime_.textContent="LIVE",this.currentTime_.style.cursor=""),this.isSeeking_||(this.dvrSeekBar_.value=e.end-i)}else{var d=r>=3600;this.currentTime_.textContent=this.buildTimeString_(i,d),this.isSeeking_||(this.dvrSeekBar_.value=i),this.currentTime_.style.cursor=""}if(0==n);else{var u=Math.max(s,e.start),h=Math.min(a,e.end);e.start,e.start,e.start}}}},e.prototype.getSeekRange=function(){return this.player_.seekRange?this.player_.seekRange():{start:this.player_.seekable().start(0),end:this.player_.seekable().end(0)}},e}(),n={startTime:0,externalSeekable:null},s=function(s){function a(r,o){t(this,a);var l=i(this,s.call(this,r));return l.options=e.mergeOptions(n,o),l.player.ready(function(){l.player.addClass("vjs-dvrseekbar")}),l.player.on("loadeddata",function(){l.ifShakaPlayer()}),l.one("playing",function(e){var t=l.tech_.sourceHandler_;if(o.flowMode){var i=0;"ShakaHandler"===t.constructor.name&&(i=t.shakaPlayer.seekRange().start+30),l.currentTime(i)}}),l}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(a,s),a.prototype.onTimeUpdate=function(e,t){var i=e.seekableFromShaka&&e.seekableFromShaka()||e.seekable(),r=document.getElementById("liveButton");i&&i.length&&(i.end(0)-e.currentTime()<30?r.className="label onair":r.className="label",e.duration(i.end(0)))},a.prototype.ifShakaPlayer=function(){var e=document.createElement("div");e.setAttribute("id","dvr-current-time"),e.innerHTML="0:00",e.className="vjs-current-time-display",this.player.controlBar.progressControl.seekBar.hide(),this.player.controlBar.progressControl.disable();var t=this.player.tech_&&this.player.tech_.currentSource_||{};if(t.hasCatchUp=!0,t.hasCatchUp){this.player.controlBar.el_.insertBefore(e,this.player.controlBar.progressControl.el_.nextSibling);var i=new r(this.player,this.options);this.player.controlBar.progressControl.el_.appendChild(i.getEl())}},a.prototype.iDontKnowWhatThisDoes=function(t,i){t.addClass("vjs-dvrseekbar"),t.controlBar.addClass("vjs-dvrseekbar-control-bar"),t.controlBar.progressControl&&t.controlBar.progressControl.addClass("vjs-dvrseekbar-progress-control");var r=document.createElement("div"),n=document.createElement("a");r.className="vjs-live-button vjs-control",n.innerHTML=document.getElementsByClassName("vjs-live-display")[0].innerHTML,n.id="liveButton",t.paused()||(n.className="vjs-live-label onair");var s=function(e){var i=t.seekableFromShaka&&t.seekableFromShaka().end()||t.seekable().end(0);t.currentTime(i-1),t.play(),e.target.className+=" onair"};n.addEventListener?n.addEventListener("click",s,!1):n.attachEvent&&n.attachEvent("onclick",function(){return s.apply(n,[window.event])}),r.appendChild(n);var a=document.getElementsByClassName("vjs-control-bar")[0],o=document.getElementsByClassName("vjs-progress-control")[0];a.insertBefore(r,o),e.log("dvrSeekbar Plugin ENABLED!",i)},a}(e.getPlugin("plugin"));return s.defaultState={},s.VERSION="0.0.1",e.registerPlugin("dvrseekbar",s),s});
